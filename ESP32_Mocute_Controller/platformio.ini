; PlatformIO Project Configuration
; ESP32 Bluetooth Gamepad Receiver for Hoverboard Control
;
; Build targets:
;   esp32_master      - Main ESP32 with Bluepad32 gamepad + hoverboard UART
;   esp32s3_master    - Main ESP32-S3 with Bluepad32 gamepad + hoverboard UART
;   esp32_satellite   - Satellite ESP32 for BT RSSI scanning + ESP-NOW
;
; Build commands:
;   pio run -e esp32_master          # Build ESP32 master
;   pio run -e esp32s3_master        # Build ESP32-S3 master
;   pio run -e esp32_satellite       # Build satellite
;
;   pio run -e esp32_master -t upload      # Flash ESP32 master
;   pio run -e esp32s3_master -t upload    # Flash ESP32-S3 master
;   pio run -e esp32_satellite -t upload   # Flash satellite

; ========================== Common Settings ==========================
[env]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200

; ========================== Master ESP32 ==========================
; Connects to Mocute 052 gamepad via Bluepad32
; Sends serial commands to hoverboard mainboard
; Receives RSSI from Satellite via ESP-NOW for direction detection
;
; Uses the Bluepad32-enhanced Arduino Core (replaces standard framework)
; This provides Bluepad32.h, uni_hid_device.h, bt/uni_bt.h natively.
; Download is ~195MB on first build (one-time).
[env:esp32_master]
build_src_filter = +<*> -<../satellite/>
platform_packages =
    framework-arduinoespressif32 @ https://github.com/ricardoquesada/esp32-arduino-lib-builder/releases/download/3.10.2/esp32-bluepad32-3.10.2.zip
build_flags =
    -DCORE_DEBUG_LEVEL=3
    -DCONFIG_BLUEPAD32_MAX_DEVICES=1
    -DMASTER_SIDE=1
    ; MASTER_SIDE: 0=LEFT, 1=RIGHT (default: RIGHT sideboard)

; ========================== Master ESP32-S3 ==========================
; Same as esp32_master but for ESP32-S3 DevKit boards
; ESP32-S3 has no PSRAM conflict on GPIO16/17, native USB-CDC
[env:esp32s3_master]
board = esp32-s3-devkitc-1
board_build.flash_size = 4MB
board_upload.flash_size = 4MB
board_build.partitions = default.csv
build_src_filter = +<*> -<../satellite/>
platform_packages =
    framework-arduinoespressif32 @ https://github.com/ricardoquesada/esp32-arduino-lib-builder/releases/download/3.10.2/esp32-bluepad32-3.10.2.zip
    toolchain-xtensa-esp32s3
build_flags =
    -DCORE_DEBUG_LEVEL=3
    -DCONFIG_BLUEPAD32_MAX_DEVICES=1
    -DMASTER_SIDE=1
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DHOVER_RX_PIN=16
    -DHOVER_TX_PIN=17
    -DLED_PIN=48
    ; MASTER_SIDE: 0=LEFT, 1=RIGHT (default: RIGHT sideboard)

; ========================== Satellite ESP32 ==========================
; Scans for gamepad BT signal and measures RSSI
; Sends RSSI to Master via ESP-NOW
; No gamepad connection, no hoverboard UART
[env:esp32_satellite]
build_src_filter = -<*> +<../satellite/>
build_flags =
    -DCORE_DEBUG_LEVEL=3
    -DSATELLITE_SIDE=0
    ; SATELLITE_SIDE: 0=LEFT, 1=RIGHT (default: LEFT sideboard)
